document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("registration-form"),u=document.getElementById("step1"),g=document.getElementById("step2"),E=document.getElementById("next-step"),b=document.getElementById("prev-step"),p=document.getElementById("submit-form"),h=document.getElementById("submit-text"),f=document.getElementById("submit-loader"),v=document.getElementById("step1-indicator"),d=document.getElementById("step2-indicator"),w=document.querySelectorAll('input[name="typeParticipation"]'),m=document.getElementById("presenter-fields"),x="https://script.google.com/macros/s/AKfycbyFR2p7VCAkPeIZllQKI1YcbLdvWwUidILMpoCECDtTkoB2xy7Pagr9LV2yNLBHnbugHA/exec",t={sending:"Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...",success:"ØªÙ… Ø­ÙØ¸ ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­.",error:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",networkError:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",serverError:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.",requiredField:"Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨",validEmail:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ§Ù„Ø­",selectStatus:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙØªÙƒ",selectTitle:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù„Ù‚Ø¨Ùƒ",selectParticipation:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©",selectTheme:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙˆØ±",selectType:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹",uploadLink:"ÙŠØ±Ø¬Ù‰ ØªÙ‚Ø¯ÙŠÙ… Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù"};E.addEventListener("click",function(){I()&&q()}),b.addEventListener("click",function(){y()}),w.forEach(r=>{r.addEventListener("change",function(){this.value==="Presenter"?(m.classList.remove("hidden"),L(!0)):(m.classList.add("hidden"),L(!1))})}),c.addEventListener("submit",async function(r){if(r.preventDefault(),!!k()){p.disabled=!0,h.classList.add("hidden"),f.classList.remove("hidden"),l("loading",t.sending);try{const s=new FormData(c),e=(s.get("ville")||",").split(",");s.set("ville",e[0]?e[0].trim():""),s.append("pays",e[1]?e[1].trim():""),console.log("ðŸ“¤ Sending FormData with fields:");for(let[a,n]of s.entries())console.log(`${a}: ${n}`);const i=await fetch(x,{method:"POST",body:s});if(console.log("ðŸ“¡ Response status:",i.status),!i.ok)throw new Error(`HTTP Error: ${i.status}`);const o=await i.json();console.log("ðŸ“¥ Response data:",o),o.ok===!0?(l("success",t.success),c.reset(),y(),setTimeout(()=>{window.location.href="/ar/tarifs"},3e3)):l("error",o.error||t.error)}catch(s){console.error("âŒ Submission error:",s),s.message.includes("fetch")||s.message.includes("NetworkError")?l("error",t.networkError):s.message.includes("HTTP")?l("error",t.serverError):l("error",t.error)}finally{p.disabled=!1,h.classList.remove("hidden"),f.classList.add("hidden")}}});function I(){let r=!0;[{id:"nom",message:t.requiredField},{id:"prenom",message:t.requiredField},{id:"civilite",message:t.selectTitle},{id:"email",message:t.validEmail},{id:"telephone",message:t.requiredField},{id:"etablissement",message:t.requiredField},{id:"ville",message:t.requiredField},{id:"statut",message:t.selectStatus}].forEach(o=>{const a=document.getElementById(o.id),n=a.parentElement.querySelector(".error-message");a.value.trim()?(a.classList.remove("border-red-500"),n&&(n.textContent="",n.classList.add("hidden"))):(a.classList.add("border-red-500"),n&&(n.textContent=o.message,n.classList.remove("hidden")),r=!1)});const e=document.getElementById("email"),i=e.parentElement.querySelector(".error-message");return e.value.trim()&&!B(e.value)&&(e.classList.add("border-red-500"),i&&(i.textContent=t.validEmail,i.classList.remove("hidden")),r=!1),r}function k(){let r=!0;const s=document.querySelector('input[name="typeParticipation"]:checked'),e=document.querySelector('input[name="typeParticipation"]').parentElement.parentElement.querySelector(".error-message");return s?e&&(e.textContent="",e.classList.add("hidden")):(e&&(e.textContent=t.selectParticipation,e.classList.remove("hidden")),r=!1),s&&s.value==="Presenter"&&[{id:"titreCommunication",message:t.requiredField},{id:"auteurs",message:t.requiredField},{id:"auteurCorrespondant",message:t.requiredField},{id:"thematique",message:t.selectTheme},{id:"choixCommunication",message:t.selectType},{id:"resumeFileLink",message:t.uploadLink}].forEach(o=>{const a=document.getElementById(o.id),n=a.parentElement.querySelector(".error-message");a.value.trim()?(a.classList.remove("border-red-500"),n&&(n.textContent="",n.classList.add("hidden"))):(a.classList.add("border-red-500"),n&&(n.textContent=o.message,n.classList.remove("hidden")),r=!1)}),r}function B(r){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)}function y(){u.classList.remove("hidden"),g.classList.add("hidden"),v.classList.remove("bg-slate-300","dark:bg-slate-600","text-slate-500"),v.classList.add("bg-brand-primary","text-white"),d.classList.remove("bg-brand-primary","text-white"),d.classList.add("bg-slate-300","dark:bg-slate-600","text-slate-500"),window.scrollTo({top:0,behavior:"smooth"})}function q(){u.classList.add("hidden"),g.classList.remove("hidden"),d.classList.remove("bg-slate-300","dark:bg-slate-600","text-slate-500"),d.classList.add("bg-brand-primary","text-white"),window.scrollTo({top:0,behavior:"smooth"})}function L(r){m.querySelectorAll("input, select").forEach(e=>{if(r)e.setAttribute("required","required");else{e.removeAttribute("required"),e.classList.remove("border-red-500");const i=e.parentElement.querySelector(".error-message");i&&(i.textContent="",i.classList.add("hidden"))}})}function l(r,s){const e=document.getElementById("alert-container"),i=document.getElementById("alert-content"),o=document.getElementById("alert-icon"),a=document.getElementById("alert-message");i.className="rounded-lg p-4 flex items-start space-x-3 rtl:space-x-reverse transform transition-all duration-500 ease-in-out",r==="loading"?(i.classList.add("bg-blue-500","text-white"),o.innerHTML='<svg class="animate-spin w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'):r==="success"?(i.classList.add("bg-green-500","text-white"),o.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'):r==="error"&&(i.classList.add("bg-red-500","text-white"),o.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),a.textContent=s,e.classList.remove("hidden"),setTimeout(()=>{i.classList.add("opacity-100","translate-y-0")},100)}function C(){const r=document.getElementById("alert-container"),s=document.getElementById("alert-content");s.classList.remove("opacity-100","translate-y-0"),s.classList.add("opacity-0","translate-y-[-20px]"),setTimeout(()=>{r.classList.add("hidden")},500)}document.getElementById("alert-close").addEventListener("click",C)});
