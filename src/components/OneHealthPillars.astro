---
import { useTranslations } from '../i18n/ui';

interface Props {
  locale: 'fr' | 'en' | 'ar';
}

const { locale } = Astro.props;
const t = useTranslations(locale);
const isRTL = locale === 'ar';
const baseUrl = import.meta.env.BASE_URL || '/';

// All 6 pillars
const pillars = [
  {
    id: 1,
    titleKey: 'pillars.human.title',
    descKey: 'pillars.human.desc',
    image: 'images/home/1.png',
    alt: 'Santé Humaine',
    defaultTitle: 'Santé Humaine',
    defaultDesc: 'Promouvoir le bien-être des populations à travers une approche préventive et intégrée.',
  },
  {
    id: 2,
    titleKey: 'pillars.animal.title',
    descKey: 'pillars.animal.desc',
    image: 'images/home/2.png',
    alt: 'Santé Animale',
    defaultTitle: 'Santé Animale',
    defaultDesc: 'Surveiller et améliorer la santé animale pour prévenir les zoonoses et garantir la sécurité sanitaire.',
  },
  {
    id: 3,
    titleKey: 'pillars.environment.title',
    descKey: 'pillars.environment.desc',
    image: 'images/home/3.png',
    alt: 'Santé Environnementale',
    defaultTitle: 'Santé Environnementale',
    defaultDesc: 'Protéger nos écosystèmes essentiels pour assurer un avenir durable pour toutes les espèces.',
  },
  {
    id: 4,
    titleKey: 'pillars.research.title',
    descKey: 'pillars.research.desc',
    image: 'images/home/4.png',
    alt: 'Recherche & Innovation',
    defaultTitle: 'Recherche',
    defaultDesc: 'Développer des solutions innovantes basées sur la science pour relever les défis de santé mondiale.',
  },
  {
    id: 5,
    titleKey: 'pillars.collaboration.title',
    descKey: 'pillars.collaboration.desc',
    image: 'images/home/5.png',
    alt: 'Collaboration Internationale',
    defaultTitle: 'Collaboration',
    defaultDesc: 'Unir les expertises internationales pour une réponse coordonnée aux enjeux sanitaires.',
  },
  {
    id: 6,
    titleKey: 'pillars.innovation.title',
    descKey: 'pillars.innovation.desc',
    image: 'images/home/6.png',
    alt: 'Innovation & Valorisation',
    defaultTitle: 'Innovation',
    defaultDesc: 'Valoriser les découvertes scientifiques pour un impact concret sur la société.',
  }
];

const getTranslation = (key: string, fallback: string) => {
  const text = t(key as any);
  return text === key ? fallback : text;
};
---

<section id="one-health-pillars" class="py-20 bg-white dark:bg-slate-950 overflow-hidden relative">
  <!-- Dot pattern background -->
  <div class="absolute inset-0 pointer-events-none opacity-30 dark:opacity-10" style="background-image: radial-gradient(#059669 1px, transparent 1px); background-size: 32px 32px;"></div>

  <div class="container mx-auto px-4 relative z-10">
    
    <!-- Section Header -->
    <div class="text-center mb-16 pillar-reveal">
      <span class="text-emerald-600 font-semibold tracking-wider uppercase text-sm mb-2 block">Thématiques</span>
      <h2 class="text-4xl md:text-5xl font-bold text-slate-900 dark:text-white mb-4">
        {t('pillars.sectionTitle') || 'Les Piliers du One Health'}
      </h2>
      <div class="w-20 h-1.5 bg-emerald-500 mx-auto rounded-full"></div>
    </div>

    <!-- Cards Grid - 3 columns on desktop -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {pillars.map((pillar, index) => (
        <div 
          class="pillar-card relative group h-[380px] rounded-3xl overflow-hidden border border-gray-200/50 dark:border-white/10 shadow-xl hover:shadow-2xl hover:shadow-emerald-900/20 transition-all duration-700 transform pillar-reveal"
          style={`--delay: ${index * 100}ms`}
        >
          <!-- Background Image -->
          <img 
            src={`${baseUrl}${pillar.image}`} 
            alt={pillar.alt}
            class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-110"
            loading="lazy"
          />
          
          <!-- Gradient Overlay -->
          <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-900/60 to-transparent opacity-80 transition-opacity duration-500 group-hover:opacity-90"></div>
          
          <!-- Number Badge -->
          <div class={`absolute bottom-20 ${isRTL ? 'left-6' : 'right-6'} text-white/10 text-8xl font-black select-none pointer-events-none transition-all duration-700 group-hover:-translate-y-2`}>
            0{pillar.id}
          </div>

          <!-- Content -->
          <div class={`absolute bottom-0 left-0 right-0 p-8 ${isRTL ? 'text-right' : 'text-left'} z-20`}>
            <h3 class="text-2xl md:text-3xl font-bold text-white mb-3 drop-shadow-md transform transition-all duration-500 group-hover:-translate-y-2">
              {getTranslation(pillar.titleKey, pillar.defaultTitle)}
            </h3>
            
            <p class="text-gray-200 text-base leading-relaxed opacity-0 translate-y-4 group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-500 ease-out">
              {getTranslation(pillar.descKey, pillar.defaultDesc)}
            </p>

            <!-- Accent Line -->
            <div class={`h-1 w-12 bg-emerald-500 mt-5 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 ${isRTL ? 'origin-right' : 'origin-left'}`}></div>
          </div>
        </div>
      ))}
    </div>

  </div>
</section>

<style>
  .pillar-reveal {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    transition-delay: var(--delay, 0ms);
  }

  .pillar-reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  const setupPillarsAnimation = () => {
    const elements = document.querySelectorAll('.pillar-reveal');
    
    if (elements.length === 0) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { 
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    elements.forEach(el => observer.observe(el));
  };

  // Run on load
  setupPillarsAnimation();

  // Re-run on Astro page transitions
  document.addEventListener('astro:page-load', setupPillarsAnimation);
</script>