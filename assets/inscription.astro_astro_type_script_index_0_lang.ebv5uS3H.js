document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("registration-form"),u=document.getElementById("step1"),g=document.getElementById("step2"),E=document.getElementById("next-step"),b=document.getElementById("prev-step"),p=document.getElementById("submit-form"),h=document.getElementById("submit-text"),f=document.getElementById("submit-loader"),y=document.getElementById("step1-indicator"),d=document.getElementById("step2-indicator"),w=document.querySelectorAll('input[name="typeParticipation"]'),m=document.getElementById("presenter-fields"),k="https://script.google.com/macros/s/AKfycbyFR2p7VCAkPeIZllQKI1YcbLdvWwUidILMpoCECDtTkoB2xy7Pagr9LV2yNLBHnbugHA/exec",t={sending:"Submitting...",success:"Your registration has been successfully saved.",error:"Submission error. Please try again.",networkError:"Network error. Check your internet and try again.",serverError:"Server error. Please try again later.",requiredField:"This field is required",validEmail:"Please enter a valid email",selectStatus:"Please select your status",selectTitle:"Please select your title",selectParticipation:"Please select a participation type",selectTheme:"Please select a theme",selectType:"Please select a type",uploadLink:"Please provide a file link"};E.addEventListener("click",function(){x()&&q()}),b.addEventListener("click",function(){v()}),w.forEach(s=>{s.addEventListener("change",function(){this.value==="Presenter"?(m.classList.remove("hidden"),L(!0)):(m.classList.add("hidden"),L(!1))})}),c.addEventListener("submit",async function(s){if(s.preventDefault(),!!I()){p.disabled=!0,h.classList.add("hidden"),f.classList.remove("hidden"),l("loading",t.sending);try{const e=new FormData(c),r=(e.get("ville")||",").split(",");e.set("ville",r[0]?r[0].trim():""),e.append("pays",r[1]?r[1].trim():""),console.log("ðŸ“¤ Sending FormData with fields:");for(let[a,o]of e.entries())console.log(`${a}: ${o}`);const i=await fetch(k,{method:"POST",body:e});if(console.log("ðŸ“¡ Response status:",i.status),!i.ok)throw new Error(`HTTP Error: ${i.status}`);const n=await i.json();console.log("ðŸ“¥ Response data:",n),n.ok===!0?(l("success",t.success),c.reset(),v(),setTimeout(()=>{window.location.href="/en/tarifs"},3e3)):l("error",n.error||t.error)}catch(e){console.error("âŒ Submission error:",e),e.message.includes("fetch")||e.message.includes("NetworkError")?l("error",t.networkError):e.message.includes("HTTP")?l("error",t.serverError):l("error",t.error)}finally{p.disabled=!1,h.classList.remove("hidden"),f.classList.add("hidden")}}});function x(){let s=!0;[{id:"nom",message:t.requiredField},{id:"prenom",message:t.requiredField},{id:"civilite",message:t.selectTitle},{id:"email",message:t.validEmail},{id:"telephone",message:t.requiredField},{id:"etablissement",message:t.requiredField},{id:"ville",message:t.requiredField},{id:"statut",message:t.selectStatus}].forEach(n=>{const a=document.getElementById(n.id),o=a.parentElement.querySelector(".error-message");a.value.trim()?(a.classList.remove("border-red-500"),o&&o.classList.add("hidden")):(a.classList.add("border-red-500"),o&&(o.textContent=n.message,o.classList.remove("hidden")),s=!1)});const r=document.getElementById("email"),i=r.parentElement.querySelector(".error-message");return r.value.trim()&&!B(r.value)&&(r.classList.add("border-red-500"),i&&(i.textContent=t.validEmail,i.classList.remove("hidden")),s=!1),s}function I(){let s=!0;const e=document.querySelector('input[name="typeParticipation"]:checked'),r=document.querySelector('input[name="typeParticipation"]').parentElement.parentElement.querySelector(".error-message");return e?r&&r.classList.add("hidden"):(r&&r.classList.remove("hidden"),s=!1),e&&e.value==="Presenter"&&[{id:"titreCommunication",message:t.requiredField},{id:"auteurs",message:t.requiredField},{id:"auteurCorrespondant",message:t.requiredField},{id:"thematique",message:t.selectTheme},{id:"choixCommunication",message:t.selectType},{id:"resumeFileLink",message:t.uploadLink}].forEach(n=>{const a=document.getElementById(n.id),o=a.parentElement.querySelector(".error-message");a.value.trim()?(a.classList.remove("border-red-500"),o&&o.classList.add("hidden")):(a.classList.add("border-red-500"),o&&(o.textContent=n.message,o.classList.remove("hidden")),s=!1)}),s}function B(s){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)}function v(){u.classList.remove("hidden"),g.classList.add("hidden"),y.classList.remove("bg-slate-300","dark:bg-slate-600","text-slate-500"),y.classList.add("bg-brand-primary","text-white"),d.classList.remove("bg-brand-primary","text-white"),d.classList.add("bg-slate-300","dark:bg-slate-600","text-slate-500"),window.scrollTo({top:0,behavior:"smooth"})}function q(){u.classList.add("hidden"),g.classList.remove("hidden"),d.classList.remove("bg-slate-300","dark:bg-slate-600","text-slate-500"),d.classList.add("bg-brand-primary","text-white"),window.scrollTo({top:0,behavior:"smooth"})}function L(s){m.querySelectorAll("input, select").forEach(r=>{if(s)r.setAttribute("required","required");else{r.removeAttribute("required"),r.classList.remove("border-red-500");const i=r.parentElement.querySelector(".error-message");i&&i.classList.add("hidden")}})}function l(s,e){const r=document.getElementById("alert-container"),i=document.getElementById("alert-content"),n=document.getElementById("alert-icon"),a=document.getElementById("alert-message");i.className="rounded-lg p-4 flex items-start space-x-3 transform transition-all duration-500 ease-in-out",s==="loading"?(i.classList.add("bg-blue-500","text-white"),n.innerHTML='<svg class="animate-spin w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'):s==="success"?(i.classList.add("bg-green-500","text-white"),n.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'):s==="error"&&(i.classList.add("bg-red-500","text-white"),n.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),a.textContent=e,r.classList.remove("hidden"),setTimeout(()=>{i.classList.add("opacity-100","translate-y-0")},100)}function T(){const s=document.getElementById("alert-container"),e=document.getElementById("alert-content");e.classList.remove("opacity-100","translate-y-0"),e.classList.add("opacity-0","translate-y-[-20px]"),setTimeout(()=>{s.classList.add("hidden")},500)}document.getElementById("alert-close").addEventListener("click",T)});
